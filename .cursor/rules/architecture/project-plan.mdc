# ðŸ“± Realtime Chat Application (WhatsApp Clone) - Project Documentation

## 1. Project Overview
This project is a modern, real-time messaging application built on **Supabase** and **Next.js 16**. The application supports both one-on-one (1:1) direct messaging and group chats. It relies on Supabase for authentication, database, and real-time subscriptions. Future iterations will include video and audio calling capabilities.

## 2. Tech Stack

### Frontend & Framework
* **Framework:** Next.js 16 (App Router)
* **Language:** TypeScript
* **Styling:** Tailwind CSS v4 (CSS-first configuration, no `tailwind.config.js`)
* **UI Components:** shadcn/ui (Radix UI primitives)
* **Icons:** Lucide React
* **State Management:** React Server Components (Server State) + React Hooks (Client State)

### Backend & Services (Supabase)
* **Database:** PostgreSQL
* **Authentication:** Supabase Auth (Google OAuth)
* **Realtime:** Supabase Realtime (Websockets for live messaging)
* **Storage:** Supabase Storage (Images, Voice messages)
* **ORM/Query:** Supabase JS Client (Type-safe)

### Development Tools
* **Linter/Formatter:** Biome (Strict & Fast)
* **IDE:** Cursor AI
* **Package Manager:** npm / pnpm

---

## 3. Database Architecture (Schema)

*Note: RLS (Row Level Security) is enabled on all tables.*

| Table Name | Description | Key Columns |
| :--- | :--- | :--- |
| **profiles** | Extended user details | `id` (PK), `username`, `avatar_url`, `status`, `last_seen` |
| **conversations** | Chat rooms (Group or Direct) | `id` (PK), `is_group`, `name`, `group_image`, `created_at` |
| **conversation_members** | Junction table (M:N) | `id` (PK), `conversation_id`, `user_id`, `role` |
| **messages** | Chat content | `id` (PK), `conversation_id`, `sender_id`, `content`, `type`, `file_url` |

---

## 4. Roles & Permissions

### User
* Can sign in using Google OAuth.
* Can update their own profile details.
* Can start a new 1:1 conversation.
* Can create a new Group.
* Can **view** messages only in conversations they are a member of (RLS).
* Can **send** messages only to conversations they are a member of (RLS).

### Admin (Group Admin)
* *Future Scope:* Can remove or add members to the group.
* Can update group metadata (name, image).

---

## 5. Folder Structure (Next.js App Router)

```text
/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/             # Authentication Routes
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”œâ”€â”€ (main)/             # Protected Routes (Requires Login)
â”‚   â”‚   â”œâ”€â”€ layout.tsx      # Sidebar + Main Content Layout
â”‚   â”‚   â”œâ”€â”€ page.tsx        # Empty State ("Select a chat")
â”‚   â”‚   â””â”€â”€ conversations/
â”‚   â”‚       â””â”€â”€ [conversationId]/
â”‚   â”‚           â””â”€â”€ page.tsx # Specific Chat Room
â”‚   â”œâ”€â”€ layout.tsx          # Root Layout (Providers)
â”‚   â””â”€â”€ globals.css         # Tailwind v4 Imports
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/               # Login Buttons, Auth Forms
â”‚   â”œâ”€â”€ sidebar/            # Sidebar, ConversationList, UserItem
â”‚   â”œâ”€â”€ chat/               # ChatHeader, ChatInput, MessageList
â”‚   â”œâ”€â”€ ui/                 # shadcn/ui components
â”‚   â””â”€â”€ modals/             # CreateGroupModal, SettingsModal
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/           # Client, Server, and Middleware clients
â”‚   â””â”€â”€ utils.ts            # CN helper, Date formatters
â”œâ”€â”€ hooks/                  # Custom hooks (useChatScroll, useActiveChannel)
â”œâ”€â”€ types/                  # Database types generated by Supabase
â””â”€â”€ middleware.ts           # Route Protection & Session Management
```

6. Development Roadmap
Phase 1: Setup & Auth (Completed âœ…)
[x] Next.js 16 + Tailwind v4 installation.

[x] Supabase Project Setup.

[x] Database Schema & RLS Policies configuration.

[ ] Google Auth Integration.

[ ] Middleware (Route Protection).

Phase 2: UI Skeleton & Sidebar
[ ] Implement Layout (Fixed Sidebar, Fluid Chat Area).

[ ] Fetch user conversations in Sidebar (Server Component).

[ ] User Search functionality (To start new chats).

[ ] 1:1 Conversation Logic (Check if exists -> Redirect; else -> Create).

Phase 3: Realtime Chat Core
[ ] Chat Header (Display other user/group info).

[ ] Message List (Scrollable area).

[ ] Message Input (Text only MVP).

[ ] sendMessage Server Action.

[ ] Realtime subscription using supabase.on('postgres_changes').

Phase 4: Advanced Features
[ ] Multimedia Support (Image upload via Supabase Storage).

[ ] Group Creation Modal.

[ ] Message Status (Sent/Delivered/Read).

[ ] Infinite Scroll (Pagination for old messages).

Phase 5: Future (Audio/Video)
[ ] WebRTC or LiveKit integration.

[ ] Video/Audio Call UI.

7. Coding Guidelines
For Developers & Cursor AI:

Minimalism: Write only the necessary code. Avoid boilerplate.

No Comments: Code should be self-documenting. Use comments only for complex regex or obscure logic.

Server First: Default to React Server Components. Use use client only for interactive boundaries (onClick, onChange, hooks).

Type Safety: Strictly use TypeScript and generated Supabase types. any is strictly forbidden.

Clean Imports: Use absolute paths (@/components/...).

Formatting: Follow Biome standards.
